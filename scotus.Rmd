---
title: "HW 3, pt. 2: Exploring U.S. Supreme Court Decisions"
author: "Julia Du"
output: github_document
---

## Get the data

```{r}
# load useful packages
library(tidyverse)
library(readr)
library(lubridate)
library(ggthemes)
library('scales')
library(forcats)

# load data
scdb_case <- read_csv("data/scdb-case.csv")
#View(scdb_case)
#, col_types = cols(sctCite = col_character())
#can docket be a character? soln for this 1st part leaves sctCite alone as a logical object

scdb_vote <- read_csv("data/scdb-vote.csv")
#View(scdb_vote)
```

## Recode variables as you find necessary

```{r}
scdb_vote %>%
mutate(recode_direction = direction-1)
```

## What percentage of cases in each term are decided by a one-vote margin (i.e. 5-4, 4-3, etc.)

```{r}
scdb_case %>%
  drop_na(term, majVotes, minVotes) %>%
  group_by(term) %>%
  mutate(V_margin = majVotes-minVotes) %>%
  mutate(onevotelgl = (V_margin == 1)) %>%
  summarize(
    totalcases = n(),
    onevote = mean(onevotelgl)
  ) %>%
 ggplot(mapping = aes(x = term, y = onevote)) +
  geom_line() +
  labs(title = "Percent of U.S. Supreme Court cases decided by 1-vote margin", x = "Term", y = "Percent of total cases decided", caption = "Source: The Supreme Court Database") +
 scale_y_continuous(labels = scales::percent) +
  theme_solarized()

#could ask abt faster way to do this...but this does give me what i need
```

## For justices [currently serving on the Supreme Court](https://www.supremecourt.gov/about/biographies.aspx), how often have they voted in the conservative direction in cases involving criminal procedure, civil rights, economic activity, and federal taxation?

Organize the resulting graph by justice in descending order of seniority. (Note that the chief justice is always considered the most senior member of the court, regardless of appointment date.)

```{r}
require(forcats)

issueArea_names <- c(
                    `1` = "Criminal Procedure",
                    `2` = "Civil Rights",
                    `8` = "Economic Activity",
                    `12` = "Federal Taxation"
                                        )
justice_levels = c("JGRoberts", "CThomas", "SGBreyer", "SAAlito", "SSotomayor", "EKagan", "NMGorsuch", "BMKavanaugh") 

#actual good stuff that WORKS
scdb_case %>%
  drop_na(issueArea) %>%
  group_by(issueArea) %>%
  filter(
    issueArea %in% c(1, 2, 8, 12)
    ) %>%
  select(caseIssuesId, issueArea) %>%
   right_join(scdb_vote, by = "caseIssuesId") %>%
mutate(OrderjusticeName = fct_relevel(justiceName, justice_levels)) %>% ###delete if this doesn't work
    group_by(OrderjusticeName, issueArea) %>%
   filter(
    OrderjusticeName %in% c("JGRoberts", "CThomas", "SGBreyer", "SAAlito", "SSotomayor", "EKagan", "NMGorsuch", "BMKavanaugh")) %>%
  drop_na(direction, issueArea) %>%  ##CAREFUL -- check on why you're getting NAs from issueArea
      mutate(conservlgl = (direction == 1)) %>%
  summarize(
    totalvotes = n(),
    conserv = mean(conservlgl)
  ) %>%
  ggplot(mapping = aes(x = conserv, y = fct_rev(OrderjusticeName))) + 
  geom_bar(stat = 'identity') +
  labs(title = "US Supreme Court", subtitle = "Percent of cases decided in a conservative direction", x = "Percent of votes cast", y = " ", caption = "Source: The Supreme Court Database") +
 scale_x_continuous(labels = scales::percent) +
  facet_wrap(issueArea ~ ., labeller = as_labeller(issueArea_names)) +
  theme_solarized()


## NORMALLY JOIN DATASETS AS FIRST STEP!!! then filter, group, summarize. would've done lines 79 & 86 first


#or maybe only grouping by issues after all & then using facet(JusticeName)? would that mean i have to undo the summarize bit?
ggplot(mapping = aes(x = conserv, y = issueArea)) + ###FIGURE OUT HOW TO ORDER BY SENIORITY
  geom_bar(stat = 'identity') +
  labs(title = "US Supreme Court", subtitle = "Percent of cases decided in a conservative direction", x = "Percent of votes cast", caption = "Source: The Supreme Court Database") +
 scale_x_continuous(labels = scales::percent) +
  facet_wrap(justiceName ~ ., labeller = as_labeller(issueArea_names)) +
  theme_solarized()
#this above was my attempt at making a graph that was faceted by justice - it didn't work. maybe cuz i'd have to summarize in a diff way (i.e. issueArea, then justiceName). do i have to make all these graphs
```

## In each term, how many of the term's published decisions (decided after oral arguments) were announced in a given month?

```{r}

```

## Which justices are most likely to agree with with the Court's declaration that an act of Congress, a state or territorial law, or a municipal ordinance is unconstitutional? Identify all cases where the Court declared something unconstitutional and determine the ten justices who most and least frequently agreed with this outcome as a percentage of all votes cast by the justice in these cases. Exclude any justice with fewer than 30 votes in cases where the Court's outcome declares something unconstitutional.

```{r}
#gives me the right graph but isn't colored
scdb_case %>%
  drop_na(declarationUncon) %>%
  group_by(declarationUncon) %>%
  filter(
    declarationUncon %in% c(2:4) #or could filter(declarationUncon > 1)
    ) %>%
  select(caseIssuesId, declarationUncon) %>%
   right_join(scdb_vote, by = "caseIssuesId") %>% #maybe try inner_join? 
   group_by(justiceName) %>%
  drop_na(majority, justiceName, declarationUncon) %>%  #would i need this if i'd done inner_join? def ran into some problems earlier
  mutate(yes_unconlgl = (majority == 2)) %>%
  summarize(
    vote_uncon = n(),
    yes_uncon = mean(yes_unconlgl)
  ) %>%
  filter(vote_uncon >= 30) %>%
  arrange(-yes_uncon) %>%
  slice(1:10, 71:80) %>%
  #do i change something w/ slice here? ASK FOR HELP HERE - HOW TO GET DIFF COLORS (SLICE INTO DIFF TABLES? HOW TO DO SO IN PIPE?)
  # mutate(type = ifelse(yes_uncon>0.90, 1)) %>% - YUP ASK FOR HELP HERE
  ggplot(mapping = aes(x = yes_uncon, y = justiceName)) + #would add fill = type to get color if mutate above worked
  geom_bar(stat = 'identity') +
  scale_x_continuous(labels = scales::percent) +
  labs(title = "U.S. Supreme Court", subtitle = "Agreement with a declaration of unconstitutionality, Justices most and least frequently in agreement", x = "Percent of votes agreeing with declaration", caption = "Source: The Supreme Court Database") 

 # scale_fill_manual("legend", values = c("A" = "black", "B" = "orange", "C" = "blue"))

#TA's thinking out loud (ran into errors)
scdb_case %>%
    filter(declarationUncon >1) %>%
    inner_join(scdb_vote) %>%
 #   drop_na(majority) %>%
    group_by(justiceName) %%
    summarize(pct = mean(majority == 1))

  
# doesn't work - end up having bars that are out of order
unconColorBar = scdb_case %>%
  drop_na(declarationUncon) %>%
  group_by(declarationUncon) %>%
  filter(
    declarationUncon %in% c(2:4)
    ) %>%
  select(caseIssuesId, declarationUncon) %>%
   right_join(scdb_vote, by = "caseIssuesId") %>%
   group_by(justiceName) %>%
  drop_na(majority, justiceName, declarationUncon) %>%  
  mutate(yes_unconlgl = (majority == 2)) %>%
  summarize(
    vote_uncon = n(),
    yes_uncon = mean(yes_unconlgl)
  ) %>%
  filter(vote_uncon >= 30) %>%
  arrange(-yes_uncon) %>%
  slice(1:10, 71:80)

uncon_colors = c("top 10" = "red", "bottom 10" = "blue")

ggplot() +
  geom_bar(data = slice(unconColorBar, 1:10), stat = 'identity', mapping = aes(x = yes_uncon, y = justiceName, fill = "top 10")) +
    geom_bar(data = slice(unconColorBar, 11:20), stat = 'identity', mapping = aes(x = yes_uncon, y = justiceName, fill = "bottom 10")) +
  scale_x_continuous(labels = scales::percent) +
  labs(title = "U.S. Supreme Court", subtitle = "Agreement with a declaration of unconstitutionality, Justices most and least frequently in agreement", x = "Percent of votes agreeing with declaration", caption = "Source: The Supreme Court Database") 
 # scale_fill_manual("legend", values = c("A" = "black", "B" = "orange", "C" = "blue"))
  

#unsure how to color top 10 & bottom 10 differently
#could try making new var for top 10 & bottom 10...but think pipe won't work 
#ideally, find a way to make (fill = new var) that distinguishes btwn top 10 & bottom 10. row #?
```

## In each term he served on the Court, in what percentage of cases was Justice Antonin Scalia in the majority?

```{r}
scdb_vote %>%
    filter(
    justiceName == "AScalia"
    ) %>%
  group_by(term) %>%
  drop_na(majority, justiceName, term) %>%  
  mutate(Scalia_majlgl = (majority == 2)) %>%
  summarize(
    totalScalia_maj = n(),
    Scalia_maj = mean(Scalia_majlgl)
  ) %>%
 ggplot(mapping = aes(x = term, y = Scalia_maj)) +
  geom_line() +
  labs(title = "Percent of the time Scalia was in the majority", x = "Term", y = "Percent of total decisions", caption = "Source: The Supreme Court Database") +
 scale_y_continuous(labels = scales::percent) +
  theme_solarized()
```

## Create a graph similar to above that adds a second component which compares the percentage for all cases versus non-unanimous cases (i.e. there was at least one dissenting vote)

```{r}
alldecisions = scdb_vote %>%
    filter(
    justiceName == "AScalia"
    ) %>%
  group_by(term) %>%
  drop_na(majority, justiceName, term) %>%  
  mutate(Scalia_majlgl = (majority == 2)) %>%
  summarize(
    totalScalia_maj = n(),
    Scalia_maj = mean(Scalia_majlgl)
  )

nonall_decisions =  
  scdb_case %>%
  drop_na(minVotes) %>%
  filter(minVotes != "0") %>%
  select(caseIssuesId, minVotes) %>%
  right_join(scdb_vote, by = "caseIssuesId") %>%
    filter(
    justiceName == "AScalia"
    ) %>%
  group_by(term) %>%
  drop_na(majority, justiceName, term, minVotes) %>%  
  mutate(dis_Scalia_majlgl = (majority == 2)) %>%
  summarize(
    dis_totalScalia_maj = n(),
    dis_Scalia_maj = mean(dis_Scalia_majlgl)
  )

Scalia_2lines = alldecisions %>%
  inner_join(nonall_decisions, by = "term") %>%
  select(-contains("total"))

# i still dunno how to add color to this
ggplot(data = Scalia_2lines) +
  geom_line(mapping = aes(x = term, y = Scalia_maj)) +
  geom_line(mapping = aes(x = term, y = dis_Scalia_maj)) 

#w/ 2 dataframes
Scaliacolors <- c("All decisions" = "red", "Non-unanimous decisions" = "blue")

ggplot() +
  geom_line(data = alldecisions, mapping = aes(x = term, y = Scalia_maj, color = "All decisions")) +
  geom_line(data = nonall_decisions, mapping = aes(x = term, y = dis_Scalia_maj, color = "Non-unanimous decisions")) +
  labs(title = "Percent of the time Scalia was in the majority", x = "Term", y = "Percent of total decisions", caption = "Source: The Supreme Court Database", color = "Legend") +
  scale_color_manual(values = Scaliacolors) +
 scale_y_continuous(labels = scales::percent) +
  theme_clean() +
  theme(legend.position="bottom")
  

  ### should try to figure out way using melt (so only 1 data frame)
# currently unable to get 2 diff colors, so try it out later
#  scale_colour_manual("", breaks = c("All decisions", "Non-unanimous decisions"),
#                      values = c("red", "blue")) +

```

## In each term, what percentage of cases were decided in the conservative direction?

```{r}
scdb_case %>%
  drop_na(term, decisionDirection) %>%
  group_by(term) %>%
  mutate(conserv_caselgl = (decisionDirection == 1)) %>%
  summarize(
    totalconserv_cases = n(),
    conserv_case = mean(conserv_caselgl)
  ) %>%
 ggplot(mapping = aes(x = term, y = conserv_case)) +
  geom_line() +
  labs(title = "U.S. Supreme Court", subtitle = "Percent of cases decided in a conservative direction", x = "Term", y = "Percent of total decisions", caption = "Source: The Supreme Court Database") +
 scale_y_continuous(labels = scales::percent) +
  theme_solarized

#trying to set up for last q's facet
fullchief_facet = scdb_case %>%
  drop_na(term, decisionDirection) %>%
  group_by(term) %>%
  mutate(conserv_caselgl = (decisionDirection == 1)) %>%
  summarize(
    totalconserv_cases = n(),
    conserv_case1 = mean(conserv_caselgl)
  ) 

trychief_facet = scdb_case %>%
  mutate(Orderchief = fct_relevel(chief, chief_levels)) %>%
  #mutate(Recode_decDirect = ifelse(decisionDirection == "2", 0, 1)) %>%
  drop_na(term, decisionDirection, Orderchief) %>%
   group_by(term, Orderchief) %>%
  mutate(conserv_caselgl = (decisionDirection == 1)) %>%
  #drop_na(conserv_caselgl) %>% #unnecessary?
  summarize(
    totalconserv_cases = n(),
    conserv_case = mean(conserv_caselgl, na.rm = TRUE)
  )

#get error. :/ 
ggplot() +
  geom_line(data = trychief_facet, mapping = aes(x = term, y = conserv_case)) +
 facet_wrap(Orderchief ~ .) +
  geom_line(data = fullchief_facet, mapping = aes(x = term, y = conserv_case1, color = "red")) %>%
 scale_y_continuous(labels = scales::percent)
 
 labs(title = "U.S. Supreme Court", subtitle = "Percent of cases decided in a conservative direction", x = "Term", y = "Percent of total decisions", caption = "Source: The Supreme Court Database") +

```

## The Chief Justice is frequently seen as capable of influencing the ideological direction of the Court. Create a graph similar to the one above that also incorporates information on who was the Chief Justice during the term.

```{r}
chief_levels = c("Jay", "Rutledge", "Ellsworth", "Marshall", "Taney", "Chase", "Waite", "Fuller", "White", "Taft", "Hughes", "Stone", "Vinson", "Warren", "Burger", "Rehnquist", "Roberts") 

#this def gives a seemingly ok graph (zoom in on values)
scdb_case %>%
  mutate(Orderchief = fct_relevel(chief, chief_levels)) %>%
  #mutate(Recode_decDirect = ifelse(decisionDirection == "2", 0, 1)) %>%
  drop_na(term, decisionDirection, Orderchief) %>%
   group_by(term, Orderchief) %>%
  mutate(conserv_caselgl = (decisionDirection == 1)) %>%
  #drop_na(conserv_caselgl) %>% #unnecessary?
  summarize(
    totalconserv_cases = n(),
    conserv_case = mean(conserv_caselgl, na.rm = TRUE)
  ) %>%
 ggplot(mapping = aes(x = term, y = conserv_case)) +
  geom_line() +
 facet_wrap(Orderchief ~ .) +
  labs(title = "U.S. Supreme Court", subtitle = "Percent of cases decided in a conservative direction", x = "Term", y = "Percent of total decisions", caption = "Source: The Supreme Court Database") +
 scale_y_continuous(labels = scales::percent)

#trying summarize mean - getting diff % values...idk. totalconserv_cases is same w/ both methods tho
scdb_case %>%
  mutate(Orderchief = fct_relevel(chief, chief_levels)) %>%
  drop_na(term, decisionDirection, Orderchief) %>%
   group_by(term, Orderchief) %>%
    mutate(Recode_decDirect = ifelse(decisionDirection == "2", 0, 1)) %>%
    summarize(
    totalconserv_cases = n(),
    conserv_case = mean(Recode_decDirect, na.rm = TRUE)
  )

```

## Session info

```{r, echo = TRUE}
devtools::session_info()
```


